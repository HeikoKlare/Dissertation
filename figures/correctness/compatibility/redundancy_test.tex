\begin{tikzpicture}[
  qvtbox/.style={text width=9.3em, inner sep=3pt, align=center, anchor=center},
  z3box/.style={text width=8.8em, inner sep=3pt, align=center, anchor=center}
]
    %% FRAMES
    % \draw[dotted, anchor=west] (-0.3, -1) rectangle (6, 7.5);
    %\draw[dotted, anchor=west] (7.2, -1) rectangle (12.3, 7.5);

    \node (r1) at (0em,18em) [draw, kit-green100, thick, dashed, anchor=north west, minimum width=11.5em,minimum height=21em,inner sep=0em] {};
    \node (r2) at (12.5em,18em) [draw, kit-green100, thick, dashed, anchor=north west, minimum width=11em,minimum height=21em] {};
    \draw[-latex, thick, kit-green100] (r1) -- (r2);
    
    %% OCL EXPRESSIONS
    \node[qvtbox, name=persEmp] at (5.75em, 12.25em) {%
\begin{lstlisting}[language=framedQVT, basicstyle=\footnotesize\ttfamily, mathescape=true, escapechar=§]
Person::firstname = fstn
$\land$ Person::lastname = lstn
$\land$ Employee::name
§\hspace{1em}§ = fstn + ' ' + lstn
\end{lstlisting}
        };
        
    \node[qvtbox, name=empRes] at (5.75em, 4em) {%
\begin{lstlisting}[language=framedQVT, basicstyle=\footnotesize\ttfamily, mathescape=true]
Resident::name = n
$\land$ Employee::name = n
\end{lstlisting}
        };
        
    \node[qvtbox, name=persRes] at (5.75em, 0) {%
\begin{lstlisting}[language=framedQVT, basicstyle=\footnotesize\ttfamily, mathescape=true, escapechar=§]
Person::firstname = fstn
$\land$ Person::lastname = lstn
$\land$ Resident::name 
§\hspace{1em}§ = fstn + ' ' + lstn
\end{lstlisting}
        };
    
    %% LABELS    
    \node[above=-0.75em of persEmp.north, anchor=south, align=center] (possiblyredundant_label) {Possibly\\ redundant predicate};
    \node[above=-0.75em of empRes.north, anchor=south, align=center] (alternative_label) {Alternative sequence\\ of predicates};
    
    %% SMT FORMULAE
    \node[name=smtPersEmp, right=12.25em of persEmp.center, yshift=-0.55em, z3box] {%
\begin{lstlisting}[language=framedQVT, basicstyle=\footnotesize\ttfamily]
(not
  (and
    (= firstname fstn)
    (= lastname lstn)
    (= name
      (str.++ fst
        (str.++ ' ' lstn)
      )
    )
  )
)
\end{lstlisting}
        };
        
    \node[name=smtEmpRes, right=12.25em of empRes.center, z3box] {%
\begin{lstlisting}[language=framedQVT, basicstyle=\footnotesize\ttfamily]
...
\end{lstlisting}
        };
        
    \node[name=smtPersRes, right=12.25em of persRes.center, z3box] {%
\begin{lstlisting}[language=framedQVT, basicstyle=\footnotesize\ttfamily]
...
\end{lstlisting}
        };
        
    \draw[-latex] (persEmp) to ([yshift=0.5em]smtPersEmp.west);
    \draw[-latex] (empRes) to (smtEmpRes);
    \draw[-latex] (persRes) to (smtPersRes);
    
    \node[above=-1em of smtEmpRes] (wedge1) {$\land$};
    \node[above=-1em of smtPersRes] (wedge2) {$\land$};
        
    %% SMT SOLVER
    \node[draw,rectangle, minimum width=4em, minimum height=3em, fill=kit-blue30, above right=9em and 1.25em of r2.east, anchor=west, align=center] (smtsolver) {SMT\\ Solver};
    \draw[-latex, thick, kit-green100] ([yshift=9em]r2.east) -- (smtsolver);
    
    %% OUTCOMES
    \node[text width=6em, font=\footnotesize, below left=1.25em and 1em of smtsolver.south west, anchor=north west] (sat) {\textbf{SAT}. The initial Horn clause is not always valid, so the predicate is not entirely redundant.\\ \emph{No removal.}};
    \node[text width=6em, font=\footnotesize, below=0.2em of sat.south west, anchor=north west] (unknown) {\textbf{UNKNOWN}. By conservativeness.\\ \emph{No removal.}};
    \node[text width=6em, font=\footnotesize, below=0.2em of unknown.south west, anchor=north west] (unsat) {\textbf{UNSAT}. The initial Horn clause is valid, so the predicate is redundant.\\ \emph{Removal.}};
    
    \draw[-latex] (smtsolver.south) -- (smtsolver.south|-sat.north);
    %\draw[-latex] (smtsolver) -- (unknown);
    %\draw[-latex] (smtsolver) -- (unsat);
    
    \node[below = 0.2em of r1] {\textbf{OCL Expressions}};
    \node[below = 0.2em of r2, name=smtf] {\textbf{SMT Formula}};
    \node[right = 8.125em of smtf.center, anchor=center] {\textbf{Result}};
\end{tikzpicture}