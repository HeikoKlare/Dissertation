%% ENUMERATIONS/DESCRIPTIONS
% Description with less indentation
\newenvironment{properdescription}[1][]{
    \begin{description}[leftmargin=1.5em, #1]
}{
    \end{description}
}

% Enumerations with justification
\newenvironment{longenumerate}[1][]{
    \begin{enumerate}[#1]
}{
    \end{enumerate}
}
\newenvironment{shortenumerate}[1][]{
    \begin{enumerate}[before=\csname par\endcsname\raggedright,#1]
}{
    \end{enumerate}
}


%% FIGURES
\usepackage{subcaption}

% Print graphics in draft mode
\usepackage{graphicx}
\setkeys{Gin}{draft=false}

% LABELS IN GRAFIKEN
\makeatletter
\def\mylabel#1#2{\begingroup
    #2%
    \def\@currentlabel{#2}%
    \phantomsection\label{#1}\endgroup
}
\makeatother


%% MARGIN NOTES
\RequirePackage{marginnote}
% TODO: Margin notes only in A4 with marginparwidth 1.5 cm or larger
\setlength{\marginparwidth}{1.15cm} % adjust margin for notes (margin to end of page)
\renewcommand*{\marginfont}{\color{darkgray}\sffamily\scriptsize}
\renewcommand*{\marginnotevadjust}{0.2\baselineskip} % shift notes a little down because of smaller font
% normal margin note
\newcommand{\mnote}[2][0pt]{
    \normalmarginpar% put to outer margin
    \leavevmode% correct placement even if marginnote before first word of paragraph
    \marginnote{#2}[#1]% put the marginnote
    \ignorespaces% ensure that there is no space due to \leavemode
}
% reversed margin note
\newcommand{\rmnote}[1]{
    \reversemarginpar% put to inner margin
    \leavevmode% correct placement even if marginnote before first word of paragraph
    \marginnote{#1}% put the marginnote
    \ignorespaces% ensure that there is no space due to \leavemode
}

%% TABLES
% SchÃ¶ne Tabellen
\RequirePackage{booktabs}
% Mit Spalten definierter Breite
% http://tex.stackexchange.com/questions/12703
\RequirePackage{array}
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
% Rowcolors
\RequirePackage[table]{xcolor} % loads also colortbl
\RequirePackage{multirow}
\newcommand{\firstlinecolor}{white}
\newcommand{\secondlinecolor}{gray!10}
\newcommand{\headinglinecolor}{gray!25}


%% TEXT
% Einheiten
\RequirePackage{siunitx}

% Checkmark and Crossmark
\usepackage{pifont}
\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%

% Proper underline with less space
\RequirePackage[normalem]{ulem}
\let\underline\uline

% pgsize-Anzeige
\RequirePackage{ifdraft}
\newcommand{\pgsize}[1]{\ifdraft{[#1]}{}}

% Mark copy from paper
% #1: Source from which it was copied
\usepackage{verbatim}
\newenvironment{copiedFrom}[1]{
    \iftoggle{showCopiedFrom}{}{\comment}
}{
    \iftoggle{showCopiedFrom}{}{\endcomment}
}


%% TODOS
\RequirePackage[obeyDraft]{todonotes}
\makeatletter
\presetkeys{todonotes}{inline}{}
\makeatother
\newcommand{\todoLater}[1]{}%\ifdraft{\todo[inline,color=kit-red30]{#1}}{}}


%% CONTRIBUTIONS
\newcounter{outercontribution}
\newcounter{contribution}[outercontribution]
\renewcommand*\thecontribution{%
    \bfseries \arabic{outercontribution}.\arabic{contribution}%
}
\newcommand*{\contributionautorefname}{\bfseries C}

% Environment
\newenvironment{contributions}{
    \refstepcounter{outercontribution}
    \begin{description}[
        leftmargin=2.5em, widest=C 2.5,
        font=\normalfont\bfseries,
    ]
}{
    \end{description}
}

% Contribution
% #1: label name
% #2: contribution name
% #3: question text
\def\contribution#1#2#3{%
    \global\expandafter\def\csname contribrepeat#1\endcsname{\paragraph{\autoref{#1} (#2):} #3}%
    \refstepcounter{contribution}
    \item[\contributionautorefname{} \thecontribution{} \textnormal{\textit{(#2)}:}] \label{#1} #3%
}

% Repetition
\newcommand{\contributionrepeat}[1]{%
    \csname contribrepeat#1\endcsname%
}


%% RESEARCH QUESTIONS
\newcounter{researchquestion}
\newcounter{subresearchquestion}[researchquestion]
\renewcommand*\theresearchquestion{%
    \bfseries \arabic{researchquestion}%
}
\renewcommand*\thesubresearchquestion{%
    \bfseries \arabic{researchquestion}.\arabic{subresearchquestion}%
}
\newcommand*{\researchquestionautorefname}{\bfseries RQ}
\newcommand*{\subresearchquestionautorefname}{\bfseries RQ}

% Environments
\newenvironment{researchquestions}{
    \begin{description}[font=\normalfont\bfseries,leftmargin=*,widest=RQ 2]
}{
    \end{description}
}
\newenvironment{subresearchquestions}{
    \begin{description}[font=\normalfont\bfseries,leftmargin=*,widest=RQ 2.4]
}{
    \end{description}
}

% Questions
% #1: label name
% #2: question text
\def\researchquestion#1#2{%
    \global\expandafter\def\csname rqrepeat#1\endcsname{\noindent\autoref{#1}: #2}%
    \refstepcounter{researchquestion}%
    \item[\researchquestionautorefname{} \theresearchquestion] \label{#1} #2%
}
\def\subresearchquestion#1#2{%
    \global\expandafter\def\csname rqrepeat#1\endcsname{\noindent\autoref{#1}: #2}%
    \refstepcounter{subresearchquestion}%
    \item[\subresearchquestionautorefname{} \thesubresearchquestion] \label{#1} #2%
}

% Repetition
\newcommand{\researchquestionrepeat}[1]{%
    \csname rqrepeat#1\endcsname%
}


%% GOAL-QUESTION-METRIC
% Macros and Counters/Labels
\newcounter{goal}
\newcounter{question}[goal]
\newcounter{metric}[question]
\renewcommand*\thegoal{%
    \arabic{goal}%
}
\renewcommand*\thequestion{%
    \arabic{goal}.\arabic{question}%
}
\renewcommand*\themetric{%
    \arabic{goal}.\arabic{question}.\arabic{metric}%
}
\newcommand*{\goalautorefname}{Goal}
\newcommand*{\questionautorefname}{Question}
\newcommand*{\metricautorefname}{Metric}

\newcommand{\goal}[1]{
    \refstepcounter{goal}%
    \textbf{Goal \thegoal:\newline (#1)}%
}
\newcommand{\question}[2][]{%
    \leftskip0.5em
    \refstepcounter{question}%
    Question \thequestion:\newline (#2)%
    \label{#1}%
}
\newcommand{\questiontext}[1]{
    \leftskip0.5em #1
}
\newcommand{\metric}[0]{
    \refstepcounter{metric}%
    \leftskip1em \textit{Metric \themetric:}%
}
\newcommand{\metrictext}[1]{
    \leftskip1em \textit{#1}
}
