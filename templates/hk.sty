% Print graphics in draft mode
\usepackage{graphicx}
\setkeys{Gin}{draft=false}

% Kurzes Inhaltsverzeichnis
\RequirePackage[tight]{shorttoc}
\RequirePackage{setspace}
\usepackage{tocloft}

% Margin Notes
\RequirePackage{marginnote}
\setlength{\marginparwidth}{1.15cm} % adjust margin for notes (margin to end of page)
\renewcommand*{\marginfont}{\color{darkgray}\sffamily\scriptsize}
\renewcommand*{\marginnotevadjust}{0.2\baselineskip} % shift notes a little down because of smaller font
% normal margin note
\newcommand{\mnote}[2][0pt]{
    \normalmarginpar% put to outer margin
    \leavevmode% correct placement even if marginnote before first word of paragraph
    \marginnote{#2}[#1]% put the marginnote
    \ignorespaces% ensure that there is no space due to \leavemode
}
% reversed margin note
\newcommand{\rmnote}[1]{
    \reversemarginpar% put to inner margin
    \leavevmode% correct placement even if marginnote before first word of paragraph
    \marginnote{#1}% put the marginnote
    \ignorespaces% ensure that there is no space due to \leavemode
}

% Schöne Tabellen
\RequirePackage{booktabs}
% Mit Spalten definierter Breite
% http://tex.stackexchange.com/questions/12703
\RequirePackage{array}
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\RequirePackage{colortbl}

% Korrekte Anführungszeichen
\RequirePackage{csquotes}

% To/Dos
\RequirePackage{todonotes}
\makeatletter
\presetkeys{todonotes}{inline}{}
\makeatother

\newcommand{\todoDiss}[1]{\todo[inline,color=kit-red30]{#1}}
\newcommand{\todoLater}[1]{}%\ifdraft{\todo[inline,color=kit-red30]{#1}}{}}

% Checkmark and Crossmark
\usepackage{pifont}
\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%

% LABELS IN GRAFIKEN
\makeatletter
\def\mylabel#1#2{\begingroup
    #2%
    \def\@currentlabel{#2}%
    \phantomsection\label{#1}\endgroup
}
\makeatother

% CONTRIBUTIONS

% OUTDATED!
% #1: label name
% #2: contribution name
% #3: contribution number
\makeatletter
\def\contributionlabel#1#2#3{\begingroup
    #2 (\textbf{#3})%
    \def\@currentlabel{\textbf{#3}}%
    \phantomsection\label{#1}\endgroup
}
\makeatother

\RequirePackage{ragged2e}
\newenvironment{contributions}[1]{
    \begin{properenumerate}[
        %labelwidth=5em, 
        %align=parleft ,
        leftmargin=*, labelsep=\widthof{ },
        label=\bfseries C #1.\arabic*,
    ]
    \setcounter{enumi}{0}
}{
    \end{properenumerate}
}

% #1: label name
% #2: contribution name
% #3: question text
\makeatletter
\def\contribution#1#2#3{%
    \global\expandafter\def\csname contribrepeat#1\endcsname{\paragraph{\researchquestionref{#1} (#2):} #3}%
    \begingroup%
    \item \textit{(#2):}\; #3%
    %\def\@currentlabel{\textnormal{\theenumi}}
    \phantomsection\label{#1}%
    \endgroup
}
\makeatother

\newcommand{\contributionrepeat}[1]{%
    \csname contribrepeat#1\endcsname%
}

\newcommand{\contributionref}[1]{%
    \textnormal{\ref{#1}}%
}


% RESEARCH QUESTIONS
\newenvironment{researchquestions}[1]{
    \begin{enumerate}[label=\bfseries RQ \arabic*]
    \setcounter{enumi}{#1-1}
}{
    \end{enumerate}
}
\newenvironment{subresearchquestions}{
    \begin{enumerate}[label*=\bfseries .\arabic*]
}{
    \end{enumerate}
}

% #1: label name
% #2: question text
\makeatletter
\def\researchquestion#1#2{%
    \global\expandafter\def\csname rqrepeat#1\endcsname{\noindent\researchquestionref{#1}: #2}%
    \begingroup%
    #2%
    %\def\@currentlabel{\textnormal{\theenumi}}
    \phantomsection\label{#1}%
    \endgroup
}
\makeatother

\newcommand{\researchquestionrepeat}[1]{%
    \csname rqrepeat#1\endcsname%
}

\newcommand{\researchquestionref}[1]{%
    \textnormal{\ref{#1}}%
}

% #1: label name
% #2: question number (without any prefix like RQ)
% #3: question text
% \makeatletter
% \def\researchquestion#1#2#3{\begingroup
%     \paragraph{\textbf{Research Question #2:}} #3%
%     \def\@currentlabel{\textit{Research Question #2}}%
%     \phantomsection\label{#1}%
%     \def\@currentlabel{\paragraph{\textbf{Research Question #2:}} #3}%
%     \phantomsection\label{#1_complete}\endgroup
% }
% \makeatother


% FIGURES
\usepackage{subcaption}

% FORMATTING
\newenvironment{nestedenum}{\begin{enumerate}[label*=\itshape \arabic*.]
	}{\end{enumerate}}

% Goal-Question-Metric
% 1: Frage
% 2: Metrik
\newcommand{\qm}[2]{
    \textit{Question:} #1\\
    \textit{Metric:} #2\\
}

% Goal-Question-Metric
% 1: Kategorie
% 2: Ziel
% 3: Frage
% 4: Metrik
\newcommand{\gqm}[4]{
    \textbf{Goal (#1): #2}\\
    \qm{#3}{#4}
}

% PGSIZE-Anzeige
\RequirePackage{ifdraft}
\newcommand{\pgsize}[1]{\ifdraft{~\color{kit-blue100}[#1]}{}}

% Mark copy from paper
% #1: Source from which it was copied
\usepackage{verbatim}
\newenvironment{copiedFrom}[1]{
    \iftoggle{showCopiedFrom}{}{\comment}
}{
    \iftoggle{showCopiedFrom}{}{\endcomment}
}

% Description with less indentation
\newenvironment{properdescription}[1][]{
    \begin{description}[leftmargin=1.5em, #1]
}{
    \end{description}
}

% Enumerations with justification
\RequirePackage{ragged2e}
\newenvironment{properenumerate}[1][]{
    \begin{enumerate}[#1]
    \justifying
}{
    \end{enumerate}
}

% Mark citations of own work (unclear whether it is necessary)
\newcommand\owncite[1]{\cite{#1}}

% Proper underline with less space
\RequirePackage[normalem]{ulem}
\let\underline\uline