%% FIGURES
\usepackage{subcaption}

% Print graphics in draft mode
\usepackage{graphicx}
\setkeys{Gin}{draft=false}

% LABELS IN GRAFIKEN
\makeatletter
\def\mylabel#1#2{\begingroup
    #2%
    \def\@currentlabel{#2}%
    \phantomsection\label{#1}\endgroup
}
\makeatother


%% TABLE OF CONTENTS
% Kurzes Inhaltsverzeichnis
\RequirePackage[tight]{shorttoc}
\RequirePackage{setspace}
\usepackage{tocloft}


%% MARGIN NOTES
\RequirePackage{marginnote}
\setlength{\marginparwidth}{1.15cm} % adjust margin for notes (margin to end of page)
\renewcommand*{\marginfont}{\color{darkgray}\sffamily\scriptsize}
\renewcommand*{\marginnotevadjust}{0.2\baselineskip} % shift notes a little down because of smaller font
% normal margin note
\newcommand{\mnote}[2][0pt]{
    \normalmarginpar% put to outer margin
    \leavevmode% correct placement even if marginnote before first word of paragraph
    \marginnote{#2}[#1]% put the marginnote
    \ignorespaces% ensure that there is no space due to \leavemode
}
% reversed margin note
\newcommand{\rmnote}[1]{
    \reversemarginpar% put to inner margin
    \leavevmode% correct placement even if marginnote before first word of paragraph
    \marginnote{#1}% put the marginnote
    \ignorespaces% ensure that there is no space due to \leavemode
}

%% TABLES
% Schöne Tabellen
\RequirePackage{booktabs}
% Mit Spalten definierter Breite
% http://tex.stackexchange.com/questions/12703
\RequirePackage{array}
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
% rowcolors
\RequirePackage[table]{xcolor} % loads also colortbl
\RequirePackage{multirow} 


%% TEXT
% Korrekte Anführungszeichen
\RequirePackage{csquotes}

% Einheiten
\RequirePackage{siunitx}

% Checkmark and Crossmark
\usepackage{pifont}
\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%

% Proper underline with less space
\RequirePackage[normalem]{ulem}
\let\underline\uline

% pgsize-Anzeige
\RequirePackage{ifdraft}
\newcommand{\pgsize}[1]{\ifdraft{~\color{kit-blue100}[#1]}{}}

% Mark copy from paper
% #1: Source from which it was copied
\usepackage{verbatim}
\newenvironment{copiedFrom}[1]{
    \iftoggle{showCopiedFrom}{}{\comment}
}{
    \iftoggle{showCopiedFrom}{}{\endcomment}
}


%% TODOS
\RequirePackage[obeyDraft]{todonotes}
\makeatletter
\presetkeys{todonotes}{inline}{}
\makeatother

\newcommand{\todoLater}[1]{}%\ifdraft{\todo[inline,color=kit-red30]{#1}}{}}


%% CONTRIBUTIONS
\RequirePackage{ragged2e}
\newenvironment{contributions}[1]{
    \begin{properenumerate}[
        %labelwidth=5em, 
        %align=parleft ,
        leftmargin=*, labelsep=\widthof{ },
        label=\bfseries C #1.\arabic*,
    ]
    \setcounter{enumi}{0}
}{
    \end{properenumerate}
}

% #1: label name
% #2: contribution name
% #3: question text
\makeatletter
\def\contribution#1#2#3{%
    \global\expandafter\def\csname contribrepeat#1\endcsname{\paragraph{\contributionref{#1} (#2):} #3}%
    \begingroup%
    \item \textit{(#2):}\; #3%
    %\def\@currentlabel{\textnormal{\theenumi}}
    \phantomsection\label{#1}%
    \endgroup
}
\makeatother

\newcommand{\contributionrepeat}[1]{%
    \csname contribrepeat#1\endcsname%
}

\newcommand{\contributionref}[1]{%
    \textnormal{\ref{#1}}%
}


%% RESEARCH QUESTIONS
\newenvironment{researchquestions}[1]{
    \begin{enumerate}[label=\bfseries RQ \arabic*]
    \setcounter{enumi}{#1-1}
}{
    \end{enumerate}
}
\newenvironment{subresearchquestions}{
    \begin{enumerate}[label*=\bfseries .\arabic*]
}{
    \end{enumerate}
}

% #1: label name
% #2: question text
\makeatletter
\def\researchquestion#1#2{%
    \global\expandafter\def\csname rqrepeat#1\endcsname{\noindent\researchquestionref{#1}: #2}%
    \begingroup%
    #2%
    %\def\@currentlabel{\textnormal{\theenumi}}
    \phantomsection\label{#1}%
    \endgroup
}
\makeatother

\newcommand{\researchquestionrepeat}[1]{%
    \csname rqrepeat#1\endcsname%
}

\newcommand{\researchquestionref}[1]{%
    \textnormal{\ref{#1}}%
}


%% ENVIRONMENTS
% Description with less indentation
\newenvironment{properdescription}[1][]{
    \begin{description}[leftmargin=1.5em, #1]
}{
    \end{description}
}

% Enumerations with justification
\RequirePackage{enumitem}
\RequirePackage{ragged2e}
\newenvironment{properenumerate}[1][]{
    \begin{enumerate}[#1]
    \justifying
}{
    \end{enumerate}
}
\newenvironment{nestedenum}{\begin{enumerate}[label*=\itshape \arabic*.]
	}{\end{enumerate}}


%% GOAL-QUESTION-METRIC
% Macros and Counters/Labels
\newcounter{goal}
\newcounter{question}[goal]
\newcounter{metric}[question]
\renewcommand*\thegoal{%
    \arabic{goal}%
}
\renewcommand*\thequestion{%
    \arabic{goal}.\arabic{question}%
}
\renewcommand*\themetric{%
    \arabic{goal}.\arabic{question}.\arabic{metric}%
}
\newcommand*{\goalautorefname}{Goal}
\newcommand*{\questionautorefname}{Question}
\newcommand*{\metricautorefname}{Metric}

\newcommand{\goal}[1]{
    \refstepcounter{goal}%
    \textbf{Goal \thegoal:\newline (#1)}%
}
\newcommand{\question}[2][]{%
    \leftskip0.5em
    \refstepcounter{question}%
    Question \thequestion:\newline (#2)%
    \label{#1}%
}
\newcommand{\questiontext}[1]{
    \leftskip0.5em #1
}
\newcommand{\metric}[0]{
    \refstepcounter{metric}%
    \leftskip1em \textit{Metric \themetric:}%
}
\newcommand{\metrictext}[1]{
    \leftskip1em \textit{#1}
}
