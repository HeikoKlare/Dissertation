% Theorems and Numbering
\let\proof\relax
\let\endproof\relax
\let\openbox\relax

\usepackage{amsthm}
\usepackage{thmtools}
\usepackage%[framemethod=tikz]
  {mdframed}

% Modified from thm-listof.sty to remove left margin in list of theorems
\providecommand{\thmtlo@newentry}
\makeatletter
\renewcommand{\thmtlo@newentry}{%
  \@xa\def\csname l@\thmt@envname\endcsname{%
    \@dottedtocline{1}{0em}{\thmt@listnumwidth}%
  }%
}
% Patch the following command for compatibility with TexLive 2019 in Overleaf
\renewcommand{\thmt@mklistcmd}{%
  \thmtlo@newentry
  \ifthmt@isstarred
    \@xa\def\csname ll@\thmt@envname\endcsname{%
      \protect\ifthmt@listswap
      \protect\else
        \protect\numberline{\protect\let\protect\autodot\protect\@empty}%
      \protect\fi
      \thmt@thmname
      \ifx\@empty\thmt@shortoptarg\else\protect\thmtformatoptarg{\thmt@shortoptarg}\fi
    }%
  \else
    \@xa\def\csname ll@\thmt@envname\endcsname{%
      \protect\ifthmt@listswap
        \thmt@thmname~\csname the\thmt@envname\endcsname
      \protect\else
        \protect\numberline{\csname the\thmt@envname\endcsname}%
        \thmt@thmname
      \protect\fi
      \ifx\@empty\thmt@shortoptarg\else\protect\thmtformatoptarg{\thmt@shortoptarg}\fi
    }%
  \fi
  \@xa\gdef\csname thmt@contentsline@\thmt@envname\endcsname{%
    \thmt@contentslineShow% default:show
  }%
}
\makeatother

\mdfdefinestyle{theoremframestyle}{% 
  innertopmargin=5pt,
  innerbottommargin=8pt,
  backgroundcolor=gray!10,
  linecolor=black,
  %roundcorner=5pt,
  linewidth=1pt,
  nobreak=true,
  skipabove=10pt,
  %skipbelow=0
}

% Remark not boxed and without linebreak after title
\declaretheoremstyle[%
  spacebelow=\parsep,
  spaceabove=\parsep,
]{remarkstyle}

% Examples without linebreak after title and in italic
\declaretheoremstyle[%
  spacebelow=\parsep,
  spaceabove=\parsep,
  bodyfont=\normalfont\itshape
]{examplestyle}

% Definitions, insights, problem statements and research goal in boxes and with linebreak after title
\declaretheoremstyle[%
  spacebelow=\parsep,
  spaceabove=\parsep,
  postheadspace=\newline,
  headpunct={\vspace{0.3\baselineskip}},
  mdframed={style=theoremframestyle}
]{definitionstyle}

% All kinds of theorems in boxes and with linebreak after title
\declaretheoremstyle[%
  spacebelow=\parsep,
  spaceabove=\parsep,
  postheadspace=\newline,
  headpunct={\vspace{0.3\baselineskip}},
  bodyfont=\normalfont\itshape,
  numberwithin=chapter,
  mdframed={style=theoremframestyle}]
{theoremstyle}


%% THEOREM DECLARATIONS
\declaretheorem[style=definitionstyle, numberwithin=chapter]{definition}
\declaretheorem[style=definitionstyle, name={Problem Statement}]{problemstatement}
\declaretheorem[style=definitionstyle, name={Research Goal}, numbered=no]{researchgoal}
\declaretheorem[style=definitionstyle]{insight}

\declaretheorem[style=remarkstyle, numbered=no]{remark}
\declaretheorem[style=examplestyle, numberwithin=chapter]{example}

% All theorems numbered with same counter and numbered within chapter
\declaretheorem[style=theoremstyle]{theorem}
\declaretheorem[style=theoremstyle]{lemma}
\declaretheorem[style=theoremstyle]{claim}
\declaretheorem[style=theoremstyle]{proposition}
\declaretheorem[style=theoremstyle]{corollary}
\makeatletter
\@counteralias{lemma}{theorem}
\@counteralias{claim}{theorem}
\@counteralias{proposition}{theorem}
\@counteralias{corollary}{theorem}
\makeatother

% Counter for equations
\counterwithin*{equation}{subsection}
