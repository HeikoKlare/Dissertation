\RequirePackage{listings}

\colorlet{stringgreen}{kit-green100}
% black}
\colorlet{commentgreen}{kit-green70}
% black}
\colorlet{keywordgreen}{kit-green100}
% black}
\colorlet{keywordblue}{kit-blue100}
% black}
% \colorlet{keywordred}{black}
\definecolor{keywordred}{rgb}{0.7,0,0.5}

\lstset{
    flexiblecolumns=true,
    basicstyle=\small\normalfont\ttfamily,
    captionpos=b,
    % numberbychapter=false,
    numbers=left,
    numberstyle=\footnotesize\color{darkgray},
    numbersep=5pt,
    % mathescape=true,
    escapechar=ยง,
    commentstyle=\ttfamily\color{commentgreen},            % type writer font for comments
    stringstyle=\color{stringgreen},%\rmfamily,             % normal font for strings
    %   showstringspaces=true,             % shows blanks in strings
    %   breaklines=true,                   % allows breaking of lines
    %   frameround=ffff,                   % see manual
    frame=lines,   
    tabsize=3,        % see manual
    %     backgroundcolor=\color{kitblue15},
}

\lstdefinelanguage{commonalities}
{
    backgroundcolor=\color{lightgray!30},
    %frame=single,
    %basicstyle=\small\ttfamily,
    keywords=[1]{concept, commonality, with, has},
    keywords=[2]{prefix},
    keywordstyle=[1]\bfseries,
    keywordstyle=[2]\itshape,
    %framesep=0.5em,
    %xleftmargin=0.5em,
    %xrightmargin=0.5em,
}

\lstdefinelanguage{QVT}{
  morekeywords={
    % relations:  
    checkonly, domain, enforce, extends, implementedby, import, 
    key, overrides, primitive, query, relation, top, 
    transformation, when, where
    % operational: 
    Bag, Collection, Dict, OrderedSet, Sequence, Set, Tuple, abstract, 
    access, and, any, assert, blackbox, break, case, class, collect, 
    collectNested, collectOne, collectselect, collectselectOne, 
    composes, compute, configuration, constructor, continue, datatype, 
    default, derived, disjuncts, do, elif, else, end, endif, 
    enum, except, exists, extends, exception, false, forAll, forEach , 
    forOne, from, helper, if, implies, import , in, inherits, init, 
    inout, intermediate, invresolve, invresolveIn, invresolveone, 
    invresolveoneIn , isUnique, iterate, late, let, library, literal, 
    log, main, map, mapping, merges, metamodel, modeltype, new, not, 
    null, object, one, or, ordered, out, package, population, primitive, property, 
    query, raise, readonly, references, refines, reject, resolve, resolveIn, resolveone, 
    resolveoneIn, return, select, selectOne, sortedBy, static, 
    switch, tag, then, transformation, true, try, typedef, unlimited, 
    uses, var, when, where, while, with, xcollect , xmap, xor, xselect 
  },
  keywordstyle=\color{kit-green100}\textbf,
  keywordstyle=[2]{\textit}, % \textcolor{kit-green100}{\textbf}},
  morecomment=[l]{--},
  morestring=[b]{'},
  numbers=left,
  stepnumber=1,
  basicstyle=\ttfamily,
  stringstyle=\color{kit-blue100},
  %tabsize=4
}

\lstnewenvironment{qvtcode}[1][]{
  \lstset{language=QVT, backgroundcolor = \color{lightlightgray},
  xleftmargin=3em,frame=single,framexleftmargin=3em,
  frame=bt, basicstyle=\ttfamily, numberstyle=\ttfamily, captionpos=b, #1}
}{}

%% Listing environment for QVT code
\lstnewenvironment{embeddedqvtcode}[1][]{
  \lstset{language=QVT, backgroundcolor = \color{lightlightgray},
  xleftmargin=0em,framexleftmargin=0em, rulecolor=\color{darkgray},
  frame=single, basicstyle=\footnotesize\ttfamily, numbers=none, captionpos=b, #1}
}{}

%% Listing environment for Z3 code
\lstnewenvironment{z3code}[1][]{
  \lstset{backgroundcolor = \color{lightlightgray},
  xleftmargin=0em,frame=single,framexleftmargin=0em, rulecolor=\color{darkgray},
  basicstyle=\ttfamily, numbers=none,
  tabsize=4, captionpos=b, #1}
}{}